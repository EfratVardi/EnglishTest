<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>The English School</title>
    <link rel="stylesheet" id="sage_css-css" href="./files/main.css" type="text/css" media="all">
    <script type="text/javascript" src="./files/jquery.js"></script>
    <script src="./files/ready.js"></script>
    <link type="text/css" rel="stylesheet" href="./files/style.css">
    <link rel="shortcut icon" href="./files/favicon.ico" type="image/x-icon">
</head>

<body>
    <main id="manage_main" role="main">
        <h2>Welcome to management interface!</h1>
            <input type="file" id="dictunaryInput" accept=".xlsx">
            <input type="file" id="testsInput" accept=".xlsx">
    </main>
    <a id="footer" href="./"></a>
    <script type="text/javascript" src="./files/modernizr.js"></script>
    <script type="text/javascript" src="./files/main.js"></script>
    <script type="text/javascript" src="./files/wp-embed.min.js"></script>
    <script src="./files/xlsx.full.min.js"></script>
    <script src="./files/FileSaver.min.js"></script>

    <script>
        dictunaryInput.addEventListener('change', function (e) {
            const dictunaryInput = document.getElementById('dictunaryInput');
            convertExcel(dictunaryInput, 'dictunary')
        });

        function convertExcel(element, fileName) {
            const file = element.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const worksheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(worksheet);
                    const jsonString = createCompletJson(jsonData)
                    downloadFile(jsonString, fileName)
                };
                reader.readAsArrayBuffer(file);
            }
        }

        function createDictunaryJson(jsonData) {
            const jsonObject = {}
            jsonData.forEach((item) => {
                const key = item['key'];
                const value = item['value'];
                jsonObject[key] = value;
            });
            return JSON.stringify(jsonObject);
        }

        function downloadFile(jsonString, fileName) {
            const blob = new Blob([jsonString], { type: 'application/json' });
            saveAs(blob, fileName + '.json');
        }

    </script>
</body>

</html>